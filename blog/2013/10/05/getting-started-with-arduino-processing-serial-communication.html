<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Abhik Pal">
    <meta name="description" content="">
    <title>Getting Started With Arduino-Processing Serial&nbsp;Communication | Abhik Pal's Weblog</title>
    <link rel="stylesheet" type="text/css" href="/theme/css/main.css">
    <link rel="stylesheet" type="text/css" href="/theme/css/monokai.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
        
<header>
<h1>
    <a href="/blog/2013/10/05/getting-started-with-arduino-processing-serial-communication" id="page-title">Getting Started With Arduino-Processing Serial&nbsp;Communication</a><br>
    <small><time datetime="2013-10-05T12:29:27+05:30">
        Saturday October 05, 2013
    </time></small>
</h1>
<small><a href="/blog/tags/arduino" class="link-box">arduino</a></small>
<small><a href="/blog/tags/processing" class="link-box">processing</a></small>
</header>
<article id="article-main">
<p>This (slightly long) tutorial will try to get a beginner started with Arduino Processing communication. This tutorial assumes that you know how to perform basic operations like uploading sketches, writing and compiling Arduino code, and some basics of&nbsp;processing.</p>
<p>The code discussed in this tutorial can be found <a class="reference external" href="http://gist.github.com/abhikpal/6822845">here</a>.</p>
<div class="section" id="gathering-what-you-need">
<h2>Gathering what you&nbsp;need</h2>
<div class="section" id="hardware">
<h3>Hardware</h3>
<p>There are a very few things that you need for performing a basic Arduino-Processing communication. Most probably you will have the major part of the components lying around you. But still (for some reason still unknown to me!), I think it is better to go through the list once. So in no particular order, these are the things you will&nbsp;need:</p>
<div class="section" id="an-arduino-board">
<h4>An Arduino&nbsp;Board</h4>
<img alt="Arduino" src="/images/arduino_processing_interact/freeduino.JPG" style="width: 50%;" />
<p>The original Arduino boards come in many flavors, from small Arduino Micros to large Arduino Megas. Arduino clones on the other hand have a different story; these boards function like an Arduino would but often have more features and are the cheaper alternatives to an official Arduino board. For this tutorial I&#8217;m going to use Freeduino <span class="caps">USB</span> Arduino compatible board designed by some guy at Probots (&lt;<a class="reference external" href="http://www.probots.co.in">http://www.probots.co.in</a>&gt;).</p>
</div>
<div class="section" id="an-led">
<h4>An <span class="caps">LED</span></h4>
<img alt="LED" src="/images/arduino_processing_interact/led.JPG" style="width: 50%;" />
<p>These are the small things that light up here and there in almost every electronics project. I&#8217;m using a standard 5mm red <span class="caps">LED</span> for this tutorial but LEDs of other color or even buzzers can be used. The use of the <span class="caps">LED</span> is optional as most of the Arduino boards have one connected on pin&nbsp;13.</p>
</div>
<div class="section" id="a-potentiometer">
<h4>A&nbsp;Potentiometer</h4>
<img alt="Potm" src="/images/arduino_processing_interact/pot.JPG" style="width: 50%;" />
<p>In addition to a <span class="caps">LED</span> and an Arduino you will need a potentiometer to act as a simple input device. We will use this potentiometer in Topic 2 to control a simple visual on our computer screen. I recommend that you solder wires to your potentiometer, because it makes them easy to connect and use. I will use a 10K rotatory potentiometer in this tutorial, but other sensors like LDRs, Infrared proximity sensors, Microphones or <span class="caps">SONAR</span> can also be used with appropriate change in the circuitry and&nbsp;code.</p>
</div>
<div class="section" id="a-3v-coin-cell">
<h4>A 3V Coin&nbsp;Cell</h4>
<img alt="coin_cell" src="/images/arduino_processing_interact/coin_cell.JPG" style="width: 50%;" />
<p>This is not exactly a necessity but having a 3V cell will help you test you LEDs or check for their polarity or make some small and awesome <span class="caps">LED</span> throwies(&lt;<a class="reference external" href="http://makezine.com/projects/extreme-led-throwies/">http://makezine.com/projects/extreme-led-throwies/</a>&gt;)</p>
<p>In addition to these you will need a <span class="caps">USB</span> cable to connect your Arduino to your computer and a soldering iron to solder wires to your&nbsp;potentiometer.</p>
</div>
</div>
<div class="section" id="software">
<h3>Software</h3>
<p>The two programs you will need for thus tutorial are the Arduino <span class="caps">IDE</span> which can be found by navigating to the &#8216;Downloads&#8217; page at &lt;<a class="reference external" href="http://www.Arduino.cc">http://www.Arduino.cc</a>&gt;. Depending on your choice you can download either of the Arduino installer or the <span class="caps">ZIP</span> archive. It is freely available and open&nbsp;source.</p>
<img alt="arduino_website" src="/images/arduino_processing_interact/arduino_download.png" />
<p>The second software is the Processing <span class="caps">IDE</span>, which too like the Arduino <span class="caps">IDE</span> is open sourced and can be downloaded for free by following the &#8216;Downloads&#8217; link at <a class="reference external" href="http://www.processing.org">http://www.processing.org</a>&nbsp;.</p>
<img alt="processing_website" src="/images/arduino_processing_interact/processing_download.png" />
</div>
</div>
<div class="section" id="sending-data-to-your-arduino-board">
<h2>Sending data to your Arduino&nbsp;board</h2>
<p>Sending data from your processing sketch to control the state of a <span class="caps">LED</span> on your&nbsp;Arduino.</p>
<div class="section" id="making-the-circuit">
<h3>Making the&nbsp;Circuit</h3>
<p>If your Arduino has a led connected to pin 13, you can jump directly to the coding&nbsp;section.</p>
<p>The circuit is super simple and you will need your Arduino board and a <span class="caps">LED</span> to make it. Disconnect power from your Arduino before you start making your&nbsp;circuit.</p>
<img alt="coin_cell_test" src="/images/arduino_processing_interact/led_test.JPG" />
<p>First test your <span class="caps">LED</span> using a 3V coin cell. Now, connect the longer lead (positive terminal) of the <span class="caps">LED</span> to pin 13 of your Arduino, the shorter lead (negative terminal) goes to the <span class="caps">GND</span> (Ground) pin near pin 13. If your <span class="caps">LED</span> has both the leads of equal length, identify the positive and the negative terminals using the 3V coin cell. Below are the computer generated and actual set up of the&nbsp;circuit:</p>
<img alt="ard_circ" src="/images/arduino_processing_interact/Processing_Arduino_1_bb.png" />
<div class="admonition admonition-update">
<p class="first admonition-title">Update</p>
<p class="last">As  <a class="reference external" href="http://forum.Arduino.cc//index.php?action=profile;u=5282">Grumpy_Mike</a> pointed out in the Arduino forum post (&lt;<a class="reference external" href="http://forum.Arduino.cc//index.php?topic=191586.0">http://forum.Arduino.cc//index.php?topic=191586.0</a>&gt;) regarding this tutorial, a current limiting resistor (330 ohms will work fine) should be added between the shorter lead of the <span class="caps">LED</span> and the Arduino ground pin. You can however directly attach the <span class="caps">LED</span> to the ground pin if your Arduino has a current limiting resistor connected on pin 13 (most of the older Arduinos have one attached, and the clone I&#8217;m using is one of&nbsp;them).</p>
</div>
<img alt="ard_circ_" src="/images/arduino_processing_interact/Slide1.JPG" />
</div>
<div class="section" id="the-arduino-code">
<h3>The Arduino&nbsp;Code</h3>
<p>Open your Arduino <span class="caps">IDE</span> and you are ready to start&nbsp;coding.</p>
<p>We start by allocating a variable name to our <span class="caps">LED</span> and setting it as output. This can be achieved by typing the following code&nbsp;snippet:</p>
<div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">ledPin</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
<p>Now, to communicate with our processing sketch we need to initialize the serial communication; this we do by calling the <tt class="docutils literal">begin()</tt> method on the <tt class="docutils literal">Serial</tt> object. The syntax used for initializing the serial port&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">baud_rate</span><span class="p">);</span>
</pre></div>
<p>Baud is a variable unit of data transmission speed, or simply 1 baud = 1 bit per second. The term &#8216;baud&#8217; comes from the name of a French inventor <span class="caps">J. M. E.</span> Baudot. A baud rate of 9600 will be fine for us. So the final line of code that we have to include in our <tt class="docutils literal">setup()</tt> function is&nbsp;:</p>
<div class="highlight"><pre><span></span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
</pre></div>
<p>Once our serial port is initialized we need to check for any available data. So, in our <tt class="docutils literal">loop()</tt> function we use a simple if statement to check if there is any available&nbsp;data.</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
<p>If data is available in the serial buffer the condition <tt class="docutils literal">Serial.available()</tt> evaluates to true and the if-block is&nbsp;executed.</p>
<p>We have opened up the serial port, checked for data availability, so our next job is to actually use the data. We will declare a variable of type <tt class="docutils literal">char</tt> called <tt class="docutils literal">inputValue</tt> and assign it to the data available in the serial buffer. We do this operation by&nbsp;using:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">inputValue</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</pre></div>
<p>The <tt class="docutils literal">read()</tt> method takes the data available in the Serial buffer and stores it in our <tt class="docutils literal">inputValue</tt> variable. This statement is typed inside the if-bock we discussed&nbsp;before.</p>
<p>Now, if the data we receive is <tt class="docutils literal">H</tt> we will turn on the <span class="caps">LED</span> if it is <tt class="docutils literal">L</tt> we will turn off the <span class="caps">LED</span>, if it is neither <tt class="docutils literal">H</tt> or <tt class="docutils literal">L</tt> we do nothing. So we add the following lines after storing the value to exhibit this&nbsp;behavior:</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">inputValue</span> <span class="o">==</span> <span class="sc">&#39;H&#39;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">inputValue</span> <span class="o">==</span> <span class="sc">&#39;L&#39;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="c1">// we will do nothing if the data is</span>
  <span class="c1">// anything other than a &#39;H&#39; or a &#39;L&#39;</span>
<span class="p">}</span>
</pre></div>
<p>Finally at the end of the <tt class="docutils literal">loop()</tt> function we will add a small <tt class="docutils literal">delay()</tt> of 10 milliseconds to avoid overloading the Arduino with&nbsp;data.</p>
<p>The final code if you have followed along should look something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// Arduino Code for Example 1</span>
<span class="c1">// (arduino_example_1.ino)</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">ledPin</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="kt">char</span> <span class="n">inputValue</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inputValue</span> <span class="o">==</span> <span class="sc">&#39;H&#39;</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">inputValue</span> <span class="o">==</span> <span class="sc">&#39;L&#39;</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="c1">// we will do nothing if the data is</span>
      <span class="c1">// anything other than a ‘H’ or a ‘L’</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>Once the code is written upload it to your Arduino, and open the Serial Monitor. Try sending the values to your Arduino like <tt class="docutils literal">H</tt>, <tt class="docutils literal">L</tt> or anything else. The <span class="caps">LED</span> should light up every time you send an <tt class="docutils literal">H</tt> and should turn off when you send a <tt class="docutils literal">L</tt>.</p>
<img alt="ard_1" src="/images/arduino_processing_interact/arduino_example_1.png" />
</div>
<div class="section" id="processing-code">
<h3>Processing&nbsp;Code</h3>
<p>We start by importing the serial library for processing and setting up a basic&nbsp;sketch.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">processing.serial.*</span><span class="o">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="mi">400</span><span class="o">);</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
<span class="o">}</span>
<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
<p>In order to send data through the serial port we need to first create an object of the Serial class. So we add the following line to our sketch after the import&nbsp;line.</p>
<div class="highlight"><pre><span></span><span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">;</span>
</pre></div>
<p>Now inside the <tt class="docutils literal">setup()</tt> function we initialize the arduinoPort object we&nbsp;created.</p>
<div class="highlight"><pre><span></span><span class="n">arduinoPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Serial</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;COM5&quot;</span><span class="o">,</span> <span class="mi">9600</span><span class="o">);</span>
</pre></div>
<p><tt class="docutils literal">this</tt> is used to indicate that it is the current sketch that is going to talk to Arduino, <tt class="docutils literal">9600</tt> is the baud rate and <tt class="docutils literal"><span class="caps">COM5</span></tt> is the <span class="caps">COM</span> port to which our Arduino is connected. You need to change the <span class="caps">COM</span> port to the port your Arduino is&nbsp;connected.</p>
<p>Now, in the <tt class="docutils literal">draw()</tt> function we will draw a simple button, clicking the button will cause the led to light up and taking the mouse cursor out of the button will cause the <span class="caps">LED</span> to turn off. We draw our button using a simple&nbsp;rectangle.</p>
<div class="highlight"><pre><span></span><span class="n">rect</span><span class="o">(</span><span class="mi">150</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</pre></div>
<p>To check if the mouse cursor is inside our button we add a simple <tt class="docutils literal"><span class="pre">if-else</span></tt> block</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">((</span><span class="n">mouseX</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseX</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseY</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseY</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="o">))</span>
<span class="o">{</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
<p>In Processing <tt class="docutils literal">mouseX</tt> and <tt class="docutils literal">mouseY</tt> are keywords and return the current mouse coordinates. So using them without any declaration will not cause any&nbsp;errors.</p>
<p>If the mouse cursor is inside our box we need to check if the mouse button is pressed (The term mouse button if not explicitly stated refers to the left mouse button) also, we need to change the color of the box to make the program a bit more interactive and intuitive to use. Therefore inside our &#8216;if&#8217; block we insert the following code&nbsp;fragment:</p>
<div class="highlight"><pre><span></span><span class="n">fill</span><span class="o">(</span><span class="mi">220</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">mousePressed</span> <span class="o">==</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
<p>Like <tt class="docutils literal">mouseX</tt> and <tt class="docutils literal">mouseY</tt> the <tt class="docutils literal">mousePressed</tt> keyword returns the state of the left mouse button i.e. <tt class="docutils literal">0</tt> if not pressed and <tt class="docutils literal">1</tt> if pressed. So whenever we press the mouse button inside the button the sketch will execute the program statements inside the second <tt class="docutils literal">if</tt> block. What we have to do now is send a command to the Arduino to light up the <span class="caps">LED</span> which we defined in the Arduino sketch to be a <tt class="docutils literal">H</tt> character so inside our second <tt class="docutils literal">if</tt> block we will&nbsp;add:</p>
<div class="highlight"><pre><span></span><span class="n">port</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;H&#39;</span><span class="o">);</span>
</pre></div>
<p>This statement sends an <tt class="docutils literal">H</tt> character to our Arduino. The method <tt class="docutils literal">write()</tt> writes the arguments inside the parenthesis to the object on which it is called. i.e if we&nbsp;type</p>
<div class="highlight"><pre><span></span><span class="n">port</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">someValue</span><span class="o">);</span>
</pre></div>
<p>It will write the contents of the variable <tt class="docutils literal">someValue</tt> to the <tt class="docutils literal">port</tt> object.</p>
<p>Finally we need to add some command which switches off the led when we take our mouse outside the button and change its color back to normal. So inside out outermost else block we will&nbsp;type:</p>
<div class="highlight"><pre><span></span><span class="n">fill</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="n">arduinoPort</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;L&#39;</span><span class="o">);</span>
</pre></div>
<p>With your Arduino connected try running the processing sketch, you should see the <span class="caps">LED</span> light up every time you click inside the box and go off once you put your mouse out of the box. You should see something similar to the screen shot&nbsp;below:</p>
<img alt="prs_1" src="/images/arduino_processing_interact/processing_example_1.png" />
<p>If something is wrong take a look at the completed code&nbsp;below:</p>
<div class="highlight"><pre><span></span><span class="c1">// Processing Code for Example 1</span>
<span class="c1">// (processing_example_1.pde)</span>
<span class="kn">import</span> <span class="nn">processing.serial.*</span><span class="o">;</span>

<span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="mi">400</span><span class="o">);</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">arduinoPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Serial</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;COM5&quot;</span><span class="o">,</span> <span class="mi">9600</span><span class="o">);</span>
<span class="o">}</span>
<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">rect</span><span class="o">(</span><span class="mi">150</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">((</span><span class="n">mouseX</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseX</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseY</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">mouseY</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="o">))</span>
  <span class="o">{</span>
    <span class="n">fill</span><span class="o">(</span><span class="mi">220</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mousePressed</span> <span class="o">==</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="n">arduinoPort</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;H&#39;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">else</span>
  <span class="o">{</span>
    <span class="n">fill</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
    <span class="n">arduinoPort</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;L&#39;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-data-from-the-arduino-to-a-processing-sketch">
<h2>Sending Data from the Arduino to a Processing&nbsp;Sketch</h2>
<div class="section" id="id1">
<h3>Making the&nbsp;Circuit</h3>
<p>In Topic 1 we sent data from our computer to the Arduino and make a light turn on and off. This time we will do it the other way round i.e. from the Arduino to the computer.
To begin with the circuit construction solder wires to your pot meter.
A computerized version of the circuit is shown&nbsp;below</p>
<img alt="ard_2" src="/images/arduino_processing_interact/Processing_Arduino_2_bb.png" />
<p>First, connect the two outer most wire to pins <span class="caps">GND</span> (Ground i.e. 0V) and the other to 5V pin. The middle wire aka the wiper should go to the pin marked&nbsp;A0</p>
<p>This way of connecting the pot meter insures that the potential difference (aka voltage) between the <span class="caps">GND</span> pin and &#8216;A0&#8217; is always a value between 0V and 5V. This setup can also be considered as an example of a simple <a class="reference external" href="http://en.wikipedia.org/wiki/Voltage_divider">Voltage Divider</a>.</p>
<p>the actual circuit is shown&nbsp;below</p>
<img alt="ard_2_" src="/images/arduino_processing_interact/Slide2.JPG" />
</div>
<div class="section" id="arduino-code">
<h3>Arduino&nbsp;Code</h3>
<p>Like the previous Arduino code we strat by creating a basic sketch and initializing the Serial&nbsp;port.</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
<p>Now, we declare a variable to store the pin number of our pot-meter. We can assign a value of &#8216;A0&#8217; to an int but to make it look more int-like I&#8217;m going to assign a value of 14 to our potPin variable (the numbering scheme for &#8216;Analog In&#8217; pins is quite simple, after digital Pin 13 A0 becomes 14, A1 becomes 15 and so&nbsp;on&#8230;)</p>
<div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">potPin</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
</pre></div>
<p>The &#8216;Analog In&#8217; pins are pre-configured as inputs so adding something&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="n">pinMode</span><span class="p">(</span><span class="n">potPin</span><span class="p">,</span> <span class="n">INTPUT</span><span class="p">);</span>
</pre></div>
<p>would be completely&nbsp;useless.</p>
<p>We now need read the pot meter and send the value over the serial port to our processing sketch. Therefore we first declare a variable of type int and assign it the value that we read from our pot meter. To do this add the following codee inside your <tt class="docutils literal">loop()</tt> function</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">potMeterReading</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">potPin</span><span class="p">);</span>
</pre></div>
<p>Next, we need to send the value we just read from our pot meter through the Serial port to our processing sketch. This can be done&nbsp;by:</p>
<div class="highlight"><pre><span></span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">potMeterReading</span><span class="p">);</span>
</pre></div>
<p>When we send something using the println method a &#8216;n&#8217; aka newline character is automatically appended at the end of our data. We will use this &#8216;n&#8217; character to later to collect our data in the processing&nbsp;sketch.</p>
<p>Finally, we add a small delay at the end of our code to make the result a bit more noticable while testing the code on the Arduino Serial&nbsp;Monitor.</p>
<div class="highlight"><pre><span></span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
<p>In case you missed something here is the completed&nbsp;code:</p>
<div class="highlight"><pre><span></span><span class="c1">// Arduino Code for Example 2</span>
<span class="c1">// (arduino_example_2.ino)</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">potPin</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">potMeterReading</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">potPin</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">potMeterReading</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>Once you have checked and compiled your code upload it to your Arduino, open the Arduino Serial Monitor and try rotating your pot meter. You should see about 10 values pop up each second on your serial monitor indicating the reading of the pot&nbsp;meter.</p>
<img alt="ard_2_c" src="/images/arduino_processing_interact/arduino_example_2.png" />
</div>
<div class="section" id="id2">
<h3>Processing&nbsp;Code</h3>
<p>We start by creating a basic processing sketch and initializing the Serial&nbsp;port</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">processing.serial.*</span><span class="o">;</span>

<span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">600</span><span class="o">,</span> <span class="mi">150</span><span class="o">);</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">220</span><span class="o">);</span>

  <span class="n">arduinoPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Serial</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;COM5&quot;</span><span class="o">,</span> <span class="mi">9600</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
<p>Now, we declare a global vaiable <tt class="docutils literal">barLength</tt> just before or <tt class="docutils literal">setup()</tt> function; this variable will store the current length of the rectangle we will display on the&nbsp;screen</p>
<div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">barLength</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</pre></div>
<p>In our <tt class="docutils literal">draw()</tt> method we have to draw a rectangle with its length equal to <tt class="docutils literal">barLength</tt>. To do this we simply&nbsp;add:</p>
<div class="highlight"><pre><span></span><span class="n">rect</span><span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="n">barLength</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</pre></div>
<p>Also, the rectangles will be drawn every time the <tt class="docutils literal">draw()</tt> function is called; so we need to make sure that the screen is clear before we try to draw a new rectangle, as not clearing the screen will cause the rectangles to be drawn on top of each other and smaller rectangles would therefore would be rendered&nbsp;invisible.</p>
<p>So, before the <tt class="docutils literal">rect()</tt> function we just called in our <tt class="docutils literal">draw()</tt> function; add the following line of&nbsp;code:</p>
<div class="highlight"><pre><span></span><span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
</pre></div>
<p>We are done setting up the basic interface for our little program. Lets start to code the actual mechanism that will interpret the values received from the&nbsp;Arduino</p>
<p>Before we do anything with the data our Arduino is sending us we need to extract the useful information from the stream of data the Arduino is sending. As discussed in Section 2.2 of this tutorial we are going to use the&#8217;n&#8217; (newline) charcter to distinguish between different sets of data the Arduino is&nbsp;sending.</p>
<p>To check when we receive the newline charcter we will use the <tt class="docutils literal">bufferUntil()</tt> mrthid and call it on our arduinoPort object we just created. So, in the <tt class="docutils literal">setup()</tt> function after the Serial port initialization add this&nbsp;line:</p>
<div class="highlight"><pre><span></span><span class="n">arduinoPort</span><span class="o">.</span><span class="na">bufferUntil</span><span class="o">(</span><span class="sc">&#39;\n&#39;</span><span class="o">);</span>
</pre></div>
<p>The line we just added will call another function called the serialEvent whenever a &#8216;n&#8217; is detected in the stream of data. The basic syntax for using the bufferUntil method&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="n">port</span><span class="o">.</span><span class="na">bufferUntil</span><span class="o">(</span><span class="n">search_term</span><span class="o">);</span>
</pre></div>
<p>Now we will add the <tt class="docutils literal">serialEvent()</tt> fuction we just discussed. To do this type the following block of code after your <tt class="docutils literal">draw()</tt> function</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">serialEvent</span><span class="o">(</span><span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">)</span>
<span class="o">{</span>

<span class="o">}</span>
</pre></div>
<p>The <tt class="docutils literal">serialEvent()</tt> function takes a object of type Serial as its parameter (which many of you might have&nbsp;noticed)</p>
<p>All we need to do now is to get the value from the Arduino convert it to a type which we can use in our program. To extract the value we will declare a temporary variable of type String to store the raw values sent by the Arduino. We do this by&nbsp;adding</p>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">rawInput</span> <span class="o">=</span> <span class="n">arduinoPort</span><span class="o">.</span><span class="na">readStringUntil</span><span class="o">(</span><span class="sc">&#39;\n&#39;</span><span class="o">);</span>
</pre></div>
<p>to our <tt class="docutils literal">serialEvent()</tt> function. This line of code stores all the values it reads from the arduinoPort object upto (but not including) the <tt class="docutils literal">'\n'</tt> character into a string which we have named <tt class="docutils literal">rawInput</tt></p>
<p>Next, we need to remove any white spaces that might have found their way into the dat a and convert the resultant string to an int. Finally we will map the values the Arduino is sending from a 0 to 1023 scale to a 0 to 575 scale in order to prevent our rectangle to escape the screen if the value gets too&nbsp;large.</p>
<p>So just after the line we added, we add the last two lines of our&nbsp;code</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">rawVal</span> <span class="o">=</span> <span class="kt">int</span><span class="o">(</span><span class="n">trim</span><span class="o">(</span><span class="n">rawInput</span><span class="o">));</span>
<span class="n">barLength</span> <span class="o">=</span> <span class="n">map</span><span class="o">(</span><span class="n">rawVal</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1023</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">575</span><span class="o">);</span>
</pre></div>
<p>In the above two lines we first trim the String rawInput to remove any white spaces using the <tt class="docutils literal">trim()</tt> function. Then we use type casting to convert the value of the trimmed string to an int using the <tt class="docutils literal">int()</tt> syntax. Finally we map the value received after type casting from a range of 0 to 1023 to a range of 0 to 575 i.e. our maximum&nbsp;barLength</p>
<p>Here is the completed code in case you missed&nbsp;something:</p>
<div class="highlight"><pre><span></span><span class="c1">// Processing Code for Example 2</span>
<span class="c1">// processing_example_2.pde</span>

<span class="kn">import</span> <span class="nn">processing.serial.*</span><span class="o">;</span>

<span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">;</span>

<span class="kt">float</span> <span class="n">barLength</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">size</span><span class="o">(</span><span class="mi">600</span><span class="o">,</span> <span class="mi">150</span><span class="o">);</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="n">noStroke</span><span class="o">();</span>
  <span class="n">fill</span><span class="o">(</span><span class="mi">220</span><span class="o">);</span>

  <span class="n">arduinoPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Serial</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;COM5&quot;</span><span class="o">,</span> <span class="mi">9600</span><span class="o">);</span>
  <span class="n">arduinoPort</span><span class="o">.</span><span class="na">bufferUntil</span><span class="o">(</span><span class="sc">&#39;\n&#39;</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>
<span class="o">{</span>
  <span class="n">background</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="n">rect</span><span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="n">barLength</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">serialEvent</span><span class="o">(</span><span class="n">Serial</span> <span class="n">arduinoPort</span><span class="o">)</span>
<span class="o">{</span>
  <span class="n">String</span> <span class="n">rawInput</span> <span class="o">=</span> <span class="n">arduinoPort</span><span class="o">.</span><span class="na">readStringUntil</span><span class="o">(</span><span class="sc">&#39;\n&#39;</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">rawVal</span> <span class="o">=</span> <span class="kt">int</span><span class="o">(</span><span class="n">trim</span><span class="o">(</span><span class="n">rawInput</span><span class="o">));</span>
  <span class="n">barLength</span> <span class="o">=</span> <span class="n">map</span><span class="o">(</span><span class="n">rawVal</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1023</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">575</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
<p>with your Arduino connected to your computer run the code. You will see a window similar to one shown below pop up and on turning the pot-meter you will see the length of the rectangle&nbsp;change.</p>
<img alt="prs2_c" src="/images/arduino_processing_interact/processing_example_2.png" />
<p>Phew! that was one long tutorial and hopefully you got to know how to perform a basic Arduino-Processing Communication. Now, you can use this knowledge to build spaceships, time machines, control robots from the internet, connect your gadgets to the net and some other cool&nbsp;stuff.</p>
<p>Feel free to post any queries, suggestions, corrections or any other related stuff in the comments below&nbsp;:).</p>
</div>
</div>

</article>
<hr>
  <section>
  <h1>Comments</h1>
  <div id="disqus_thread" aria-live="polite">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
  <script type="text/javascript">
    var disqus_shortname = 'the-abhikpal-weblog';
    var disqus_identifier = '/blog/2013/10/05/getting-started-with-arduino-processing-serial-communication';
    var disqus_url = 'http://abhikpal.github.io/blog/2013/10/05/getting-started-with-arduino-processing-serial-communication';
    var disqus_title = 'Getting Started With Arduino-Processing Serial&nbsp;Communication';
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  </section>
    <footer>
        <a class="link-no-box" href="/">Blog Home</a>
        <a class="link-no-box" href="https://www.github.com/abhikpal">Github</a>
        <a class="link-no-box" href="/blog/archives">Archives</a>

        <br>

        <a href="/">Abhik Pal's Weblog</a> was built using
        <a href="http://docs.getpelican.com/en/stable/">Pelican</a>.
        Original articles on this site are CC
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode">BY-NC-SA</a>
        licensed unless otherwise stated.
    </footer>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-81134558-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>